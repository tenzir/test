name: Release

on:
  workflow_dispatch:
    inputs:
      bump:
        description: Version bump type
        required: true
        type: choice
        options:
          - minor
          - patch
          - major
      intro:
        description: |
          Intro of the release

          The intro should be 1-2 sentences long, must be written in active
          voice, and should clearly communicate the theme of the release to the
          user. Use full sentences and avoid abbreviations.
        required: true
        type: string
      title:
        description: |
          User-facing release title (auto-generated if omitted)
        required: false
        type: string

jobs:
  release:
    uses: tenzir/ship/.github/workflows/reusable-release.yaml@main
    with:
      bump: ${{ inputs.bump }}
      intro: ${{ inputs.intro }}
      title: ${{ inputs.title }}
      git-add-paths: pyproject.toml uv.lock
      pre-create: |
        uv sync --dev
        uv run ruff check
        uv run ruff format --check
        uv run mypy
        uv run pytest
        uv build
      post-create: |
        uv version --bump ${{ inputs.bump }}
    secrets: inherit
